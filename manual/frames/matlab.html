<!-- %***************************************************************************************************
% Copyright 2006, S. Bourdarie, T.P. O'Brien
%
% This file is part of IRBEM-LIB.
%
%    IRBEM-LIB is free software: you can redistribute it and/or modify
%    it under the terms of the GNU Lesser General Public License as published by
%    the Free Software Foundation, either version 3 of the License, or
%    (at your option) any later version.
%
%    IRBEM-LIB is distributed in the hope that it will be useful,
%    but WITHOUT ANY WARRANTY; without even the implied warranty of
%    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
%    GNU Lesser General Public License for more details.
%
%    You should have received a copy of the GNU Lesser General Public License
%    along with IRBEM-LIB.  If not, see <http://www.gnu.org/licenses/>.
% -->
<html>
<head>
</head>
<body>
    <h2><font face="ARIAL, HELVETICA"><font color="#0000ff">INTRODUCTION</font></font> 
    </h2>
    <p>
    </p>
    <p>
        <font face="ARIAL, HELVETICA"><font size=+1>We provide a set of Matlab wrappers for
        the ONERA/DESP FORTRAN library through the use of a shared library file (.dll on windows,
        .so on Unix). Matlab refers to this type of interface as a "mex file". In addition
        to the shared library file, Matlab requires a C-style header file that includes the
        C-style calling syntax for each FORTRAN function. This .h file is provided with the
        ONERA/DESP Matlab library.</font></font> 
    </p>
    <p>
    </p>
    <p>
    </p>
    <h2><font face="ARIAL, HELVETICA"><font color="#0000ff">INSTALLATION</font></font> 
    </h2>
    <p>
    </p>
    <p>
        <font face="ARIAL, HELVETICA"><font size=+1>The ONERA/DESP compile scripts will create
        the shared library file for use with IDL or Matlab. A copy of the shared library is
        created in the "matlab" subdirectory, and is given a name "onera_desp_lib.dll" or
        "onera_desp_lib.so" depending on the platform. Thus, in order to access the library
        and the wrappers, the user needs only add the "matlab" subdirectory (e.g. "c:\onera_desp\matlab")
        to the Matlab path. In order for the library to easily locate the data files that
        it needs, it is also advisable to add the "data" subdirectory to the Matlab path.
        Matlab provides a GUI interface to add folders to the search path from "Set Path"
        entry on the "File" menu. It is also possible to add these two folders to the path
        using the Matlab "addpath" command; however, this command does not make the change
        to the path permanent, so that "addpath" will have to be issued once in each new Matlab
        session. The "savepath" function can make the path change permanent, as can the GUI
        path manager interface. Thus, one could use the following commands, if the ONERA library
        is located in "c:\onera_desp": 
        <br />
        <br />
        addpath c:\onera_desp\matlab c:\onera_desp\data 
        <br />
        savepath </font></font>
    </p>
    <p>
        <font face="ARIAL, HELVETICA"><font size=+1>
        <br />
        &nbsp; </font></font>
    </p>
    <p>
    </p>
    <h2><font face="ARIAL, HELVETICA"><font color="#0000ff">USE OF THE MATLAB LIBRARY</font></font> 
    </h2>
    <p>
    </p>
    <p>
        <font face="ARIAL, HELVETICA"><font size=+1>The Matlab wrappers are built to provide
        Matlab-like function calls into the library. These wrappers handle loading the library
        into Matlab's function space, formatting inputs and outputs for proper calls to the
        library, and providing "vectorized" functionality wherever reasonable. Each wrapper
        function will determine whether the FORTRAN library has been loaded, and, if not,
        attempt to load it from the default location (anywhere in the Matlab path). 
        <br />
        <br />
        Each .m file provided includes a robust set of helps obtainable via help &lt;funtion_name&gt;
        in the usual Matlab way. This help call will provide details of how to call the function. 
        <br />
        <br />
        Although the FORTRAN library often limits the size of arrays, the Matlab wrappers
        typically handle arbitrarily large array inputs by splicing together multiple calls
        to the library. Also, in many cases, when a set of arrays is expected as input, the
        Matlab wrappers will accept scalars for some, which will be repeated (via Matlab's
        repmat function) to be the same size as the other array arguments. 
        <br />
        <br />
        The Matlab library also provides a single function for doing all coordinate rotations.
        This function, onera_desp_lib_rotate will perform rotations between any coordinate
        system supported by the library. It will also compute the most efficient multi-step
        rotation for those rotations not explicitly implemented in the FORTRAN library. 
        <br />
        <br />
        In many cases, the library requires integer inputs that represent different options,
        e.g., kext=5 for the Olson-Pfitzer Quiet external field model. In most cases, the
        Matlab wrapper supports string (keyword) inputs in place of the integer values. This
        keyword approach is implemented for kext, options, sysaxes, and whichm, among others. 
        <br />
        <br />
        Whenever date/time arguments are required by the FORTRAN library, the Matlab library
        expects Matlab Date Numbers (construct argument "matlabd" with Matlab's datenum function). 
        <br />
        <br />
        The FORTRAN library function fly_in_afrl_crres requires a set of text files. If the
        path to these files is not specified, the wrapper will attempt to guess it by locating
        one of these, 'crrespro_quiet.txt' in the Matlab search path. 
        <br />
        <br />
        When available from MATLAB a calling sequence is provided for each function (see detailled
        description of each functions). 
        <br />
        Note that the following function handles all coordinate rotations. In some cases,
        the FORTRAN library requests the coordinates as separate arguments (e.g., alt, lat,
        lon). For these functions, the Matlab wrapper expects a single Nx3 matrix, constructed
        by, e.g., X = [alt(:), lat(:), lon(:)]. Also, some rotations are time invariant and
        the matlabd argument can be omitted. The helps for onera_desp_lib_rotate provide a
        list of available rotations. This function will also perform multi-step rotations
        as needed to move between any set of supported coordinate systems.<br />
        Y = onera_desp_lib_rotate(X,rotation,matlabd)<br />
        [Y,psi] = onera_desp_lib_rotate(X,rotation,matlabd) </font></font>
    </p>
    <p>
    </p>
    <h2><font face="ARIAL, HELVETICA"><font color="#0000ff">HELPER FUNCTIONS </font></font>
    </h2>
    <p>
        <font face="ARIAL, HELVETICA"><font size=+1>Helper functions that support the wrappers: 
        <br />
        The following function creates the proper maginputs array for use with the field models. 
        <br />
        maginputs = onera_desp_lib_maginputs(Kp,Dst,Nsw,Vsw,Psw,ByGSM,BzGSM,G1,G2,G3,W1,W2,W3,W4,W5,W6,AL); 
        <br />
        <br />
        The following funnction will load the shared library file from the non-default location. 
        <br />
        onera_desp_lib_load(libfile,headerfile); 
        <br />
        <br />
        The following functions are used by the library to convert the Matlab wrapper inputs
        into the inputs needed by the FORTRAN library. These include "as appropriate" the
        look-up tables that convert keyword inputs into the integer constants used by the
        FORTAN library. 
        <br />
        kext = onera_desp_lib_kext(kext); 
        <br />
        options = onera_desp_lib_options(inoptions); 
        <br />
        sysaxes = onera_desp_lib_sysaxes(sysaxes) ; 
        <br />
        [iyear,idoy,UT] = onera_desp_lib_matlabd2yds(matlabd); 
        <br />
        </font></font>
    </p>
</body>
</html>
